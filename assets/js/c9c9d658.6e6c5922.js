"use strict";(self.webpackChunkmaptaskr_docs_copy=self.webpackChunkmaptaskr_docs_copy||[]).push([[1758],{94966:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var r=n(74848),a=n(28453);const o={title:"Tutorials | Power Pages Layer Feature Selection | Configuring PCF & Power Pages Management",sidebar_label:"Configuring PCF & Power Pages Management"},i="Configuring PCF & Power Pages Management",s={id:"tutorials/maptaskr-for-power-pages-selecting-layer-features/configuring-portal-form-js",title:"Tutorials | Power Pages Layer Feature Selection | Configuring PCF & Power Pages Management",description:"Ensure you follow our Power Pages Installation Guide before continuing this section. It is crucial that you have created all the neccessary records and settings to allow the PCF to function correctly.",source:"@site/docs/tutorials/maptaskr-for-power-pages-selecting-layer-features/configuring-portal-form-js.md",sourceDirName:"tutorials/maptaskr-for-power-pages-selecting-layer-features",slug:"/tutorials/maptaskr-for-power-pages-selecting-layer-features/configuring-portal-form-js",permalink:"/docs/tutorials/maptaskr-for-power-pages-selecting-layer-features/configuring-portal-form-js",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Tutorials | Power Pages Layer Feature Selection | Configuring PCF & Power Pages Management",sidebar_label:"Configuring PCF & Power Pages Management"},sidebar:"maptaskrSidebar",previous:{title:"Configuring Dynamics 365 & PowerApps",permalink:"/docs/tutorials/maptaskr-for-power-pages-selecting-layer-features/configuring-dynamics"},next:{title:"Introduction",permalink:"/docs/tutorials/maptaskr-for-dynamics-365-layer-attribute-popup-custom-actions/introduction"}},l={},d=[];function u(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"configuring-pcf--power-pages-management",children:"Configuring PCF & Power Pages Management"}),"\n",(0,r.jsxs)(t.p,{children:["Ensure you follow our ",(0,r.jsx)(t.a,{href:"/docs/power-pages/installation-guide/maptaskr-for-power-pages-setup",children:"Power Pages Installation Guide"})," before continuing this section. It is crucial that you have created all the neccessary records and settings to allow the PCF to function correctly."]}),"\n",(0,r.jsx)(t.p,{children:"Let's create a Multi Step Form for our Permit Application"}),"\n",(0,r.jsx)(t.p,{children:"Create a form step for the first tab of the form we created in the previous section, and a form step that will contain our map."}),"\n",(0,r.jsxs)(t.p,{children:["Once the form step is configured, select the ",(0,r.jsx)(t.code,{children:"Form Options"})," tab and scroll down to the ",(0,r.jsx)(t.code,{children:"Custom JavaScript"})," section."]}),"\n",(0,r.jsxs)(t.p,{children:["We want to utilise the ",(0,r.jsx)(t.a,{href:"/docs/power-pages/registerable-events/map-interaction-events/#featuresselected",children:"FeatureSelected"})," event.\nBelow is a snippet of JavaScript that will detect when a layer feature is selected and will generate a button in the attribute pop-up that will allow the user to select the highlighted feature. Selecting the button will populate our fields on the form with the desired layer attributes."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:n(66723).A+"",width:"1120",height:"834"})}),"\n",(0,r.jsxs)(t.admonition,{type:"note",children:[(0,r.jsx)(t.p,{children:"This code snippet will respond to ANY layer currently on the map, this tutorial operates under the assumption that only one layer will be made available to the end-user.\nPlease do your due-dilligence and add your own additional checks if you plan to expose more than one layer."}),(0,r.jsx)(t.p,{children:"You will also need to modify some sections to suit your needs better. These have been highlighted for your attention."})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:"\nfunction addButtonToDialog() {\n    // Check if the button already exists in the .mtr-sidenav-content\n    let sidenavContent = document.querySelector('.mtr-sidenav-content');\n    if (!sidenavContent) return; // Exit if the container doesn't exist\n    if (sidenavContent.querySelector('#selectProperty')) return; // Exit if button already exists\n\n     // Identify the current sidebar object ID and tenement ID\n    let oid = null;\n    let tenid = null;\n    let rows = sidenavContent.querySelectorAll('table tr');\n    rows.forEach((row) => {\n        let cells = row.querySelectorAll('td');\n        if (cells.length > 1) {\n            // highlight-start\n            if (cells[0].textContent.trim() === 'OID') {\n                oid = cells[1].textContent.trim();\n            }\n            if (cells[0].textContent.trim() === 'TENID') {\n                tenid = cells[1].textContent.trim();\n            }\n            // highlight-end\n        }\n    });\n\n    // highlight-start\n    if (!oid || !tenid) {\n        console.warn('OID or TENID not found in sidebar content.');\n        return;\n    }\n    // highlight-end\n\n    // Create the button element\n    let button = document.createElement('button');\n    button.id = 'selectProperty';\n    button.className = 'btn btn-primary';\n    button.type = 'button';\n    button.style.backgroundColor = 'var(--main-colour)';\n    button.style.padding = '10px';\n    button.style.margin = '10px';\n    button.style.width = 'calc(100% - 20px)';\n    button.style.fontSize = '14px';\n\n    // highlight-start\n    button.textContent = 'Use this Tenement for the Application';\n    // highlight-end\n\n    // Set the button's click event\n    button.onclick = function (event) {\n        event.preventDefault(); // Prevent default behavior\n\n        $(\"#mapdemo_relatedfeatureid\").val(oid); // Set OID\n        $(\"#mapdemo_relatedfeaturename\").val(tenid); // Set TENID\n\n        // Smooth scroll to the target element\n        $('html, body').animate({\n            scrollTop: $(\"#mapdemo_relatedfeaturename\").offset().top,\n        }, 500);\n    };\n\n    // Add the button to the sidenav content\n    let targetDiv = document.querySelector(\".mtr-right-container .row.mtr-sticky-panel-content\");\n    if (targetDiv) {\n        targetDiv.insertBefore(button, targetDiv.firstChild);\n    }\n\n    // Hook up to all <a> elements in the dialog to re-call this function after timeout\n    let links = sidenavContent.querySelectorAll('a');\n    links.forEach((link) => {\n        link.addEventListener('click', () => {\n            setTimeout(addButtonToDialog, 100); // Re-call after a short delay\n        });\n    });\n}\n\n\nwindow.maptaskrReady = function() {\n    console.log(\"Maptaskr has Loaded\");\n    console.log(window.maptaskrPCF);\n\n    //put your event registrations here\n    //window.maptaskrPCF.on(\"ShapeDrawingCompleted\", ...)\n    window['maptaskrPCF'].on(\"FeaturesSelected\", function(featureArray) {\n        setTimeout(addButtonToDialog, 100); // Delay to allow for UI adjustments if necessary\n    });\n\n    $(document).ready(function() {    \n        $(\"#mapdemo_relatedfeatureid\").attr(\"style\", \"display:none;\");\n        $(\"#mapdemo_relatedfeaturename\").attr(\"readonly\", \"readonly\");\n        $(\"#mapdemo_relatedfeaturename\").attr(\"placeholder\", \"Please click on the map to select a tenement\");\n    });\n}\n\n"})}),"\n",(0,r.jsx)(t.p,{children:"Now let's try it out!"}),"\n",(0,r.jsx)(t.p,{children:"We can select a layer feature on the map which populates the form field."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:n(2618).A+"",width:"895",height:"930"})}),"\n",(0,r.jsxs)(t.p,{children:["We can also go into D365 and open the record level map for that record (The setup for this is not covered in this tutorial, please refer to ",(0,r.jsx)(t.a,{href:"/docs/dynamics-365/installation-guide/custom-entities-configuration#adding-maptaskr-to-a-custom-entity-form",children:"Adding Maptaskr to a Custom Entity Form"}),"), and due to our DataSource GIS configuration, the layer will automatically filter, render and zoom to the submitted feature."]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:n(26389).A+"",width:"1579",height:"807"})}),"\n",(0,r.jsx)(t.p,{children:"Lastly, we will cover the custom JavaScript required for a view/edit form. This will grab the feature identifier from the form field, zoom in and highlight the layer feauture."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",children:'window.maptaskrReady = function() {\n    console.log("Maptaskr has Loaded");\n    console.log(window.maptaskrPCF);\n\n    //using the url to the arcgis layer to retrieve the geometry\n    let oid = $("#mapdemo_relatedfeatureid").val();\n    let featureUrl = "yourarcgislayerurl/query?where=oid+%3D+" + oid + "&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Kilometer&relationParam=&outFields=&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=3857&havingClause=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=false&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=json"\n    $.ajax(featureUrl).then((data) => {\n\n        //Create the Feature from the extent.\n        let geoJson = {\n            "type": "Feature",\n            "properties": {},\n            "geometry": {\n                "coordinates": data.features[0].geometry.rings,\n                "type": "Polygon"\n            },\n            "id": 1\n        }\n        //create a highlighted feature\n        maptaskrPCF.addHighlight(geoJson, "#FF0000", "#FF000055");\n    });\n\n    //now let\'s retrieve the extent of the feature \n    let url = "yourarcgislayerurl/query?where=oid+%3D+" + oid + "&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&distance=&units=esriSRUnit_Kilometer&relationParam=&outFields=&returnGeometry=false&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=3857&havingClause=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&historicMoment=&returnDistinctValues=false&resultOffset=&resultRecordCount=&returnExtentOnly=true&datumTransformation=&parameterValues=&rangeValues=&quantizationParameters=&featureEncoding=esriDefault&f=json"\n    $.ajax(url).then((data) => {\n\n        //create latlong extent for navigation\n        let minExtent = maptaskrPCF.getLatLongFromCoordinate(data.extent.xmin, data.extent.ymin)\n        let maxExtent = maptaskrPCF.getLatLongFromCoordinate(data.extent.xmax, data.extent.ymax)\n\n        //zoom to the extent\n        maptaskrPCF.navigateToExtent(minExtent.latitude, minExtent.longitude, maxExtent.latitude, maxExtent.longitude);\n    });\n\n\n\n}\n//hide the form fields\n$(document).ready(function() {\n    $("#mapdemo_relatedfeatureid").attr("style", "display:none;");\n    $("#mapdemo_relatedfeaturename").attr("style", "display:none;");\n});\n'})}),"\n",(0,r.jsx)(t.p,{children:"Let's demonstrate the functionality end-to-end!"}),"\n",(0,r.jsxs)(t.p,{children:["Portal user submitting a boundary:\n",(0,r.jsx)(t.img,{src:n(82089).A+"",width:"1145",height:"929"})]}),"\n",(0,r.jsxs)(t.p,{children:["Internal user viewing the submission in D365:\n",(0,r.jsx)(t.img,{src:n(35898).A+"",width:"1440",height:"924"})]}),"\n",(0,r.jsxs)(t.p,{children:["Portal user viewing their submission:\n",(0,r.jsx)(t.img,{src:n(96528).A+"",width:"1553",height:"924"})]})]})}function c(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},66723:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/figure-12-3b0556390935d191cc65881203b038d5.png"},2618:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/figure-13-44ec577bee6616a46584c5904857838a.png"},26389:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/figure-14-bc6a8ad29836c409565955c234c11ffb.png"},35898:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/internal-user-seing-selected-feature-5604d69055c38bbc442456b29fa63b7a.gif"},96528:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/portal-user-seing-selected-feature-0a23300cdaec262226b7ed1d7c2ce762.gif"},82089:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/portal-user-selecting-layer-c574ce7ee1149d370cc5eb385a67c5ef.gif"},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>s});var r=n(96540);const a={},o=r.createContext(a);function i(e){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);