"use strict";(self.webpackChunkmaptaskr_docs_copy=self.webpackChunkmaptaskr_docs_copy||[]).push([[6882],{86775:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var a=n(74848),s=n(28453);const i={},r="Displaying existing cases",o={id:"tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",title:"Displaying existing cases",description:"The loadDataverseLayersCustomEndpoint property is used to display records from Dataverse. In this scenario we used it to display existing Case records on the map. See: Advanced Configuration and Capability. A web template containing fetchXML is used to retrieve the records to be shown.",source:"@site/docs/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases.md",sourceDirName:"tutorials/maptaskr-for-power-pages-311-solution",slug:"/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"maptaskrSidebar",previous:{title:"Incident map",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/incident-map"},next:{title:"Reporting a problem",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/reporting-a-problem"}},c={},d=[];function p(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",img:"img",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"displaying-existing-cases",children:"Displaying existing cases"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint"})," property is used to display records from Dataverse. In this scenario we used it to display existing Case records on the map. See: ",(0,a.jsx)(t.a,{href:"/docs/power-pages/installation-guide/advanced-configuration-and-capability#custom-endpoints-to-load-related-table-records",children:"Advanced Configuration and Capability"}),". A web template containing fetchXML is used to retrieve the records to be shown."]}),"\n",(0,a.jsxs)(t.p,{children:["Create a new Web Template, in our environment we have called this ",(0,a.jsx)(t.code,{children:"Maptaskr Cases Layer"}),"."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(35152).A+"",width:"936",height:"491"})}),"\n",(0,a.jsx)(t.p,{children:"For the Source enter the following fetchxml (Please note that your field prefixes and attribute names may differ to the below example). This template is also used for the Infobox that appears when you click on a pin."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(41401).A+"",width:"1430",height:"751"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-xml",children:'{% fetchxml case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{ "layers": [\n      {\n          "LayerName": "Cases",\n          "LayerStrokeColor": "#FF0000",\n          "LayerFillColor": "#FF0000",\n          "LayerFeatures": [\n            {% for case in case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n      }\n  ]\n}\n\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Now we need to create a Web Page that uses the ",(0,a.jsx)(t.code,{children:"Maptaskr Cases Layer"})," Web Template. The Partial URL of the Maptaskr Cases Layer Web Page is the value that is used for the ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint"})," property. Please note that you will need to prefix this partial URL with a ",(0,a.jsx)(t.code,{children:"/"})," as per the documentation.\ne.g. ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint:'/active-incidents'"})]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(58466).A+"",width:"936",height:"491"})}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsx)(t.p,{children:"The Maptaskr PCF control does not display correctly in the Design Studio but can be viewed when the page is previewed. Completed page shown below:"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(48971).A+"",width:"1430",height:"732"})}),"\n",(0,a.jsx)(t.p,{children:"Clicking on a pin displays an Infobox containing key information about the case."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(27580).A+"",width:"871",height:"468"})})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},35152:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture4-33f06177971455cda73c829a69f43072.png"},41401:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture5-a18be4a5ac81ac41e13f0423d5e6c5c6.png"},58466:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture6-b08e248c8533a15ddb3d3d244658b186.png"},48971:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture7-16851f0b40bc68dc9541d89f8fccc9f4.png"},27580:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture8-99f7fbb7670fea610f49021b9ac27883.png"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var a=n(96540);const s={},i=a.createContext(s);function r(e){const t=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);