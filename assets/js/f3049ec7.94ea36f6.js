"use strict";(self.webpackChunkmaptaskr_docs_copy=self.webpackChunkmaptaskr_docs_copy||[]).push([[6882],{71976:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var a=n(74848),i=n(28453);const r={},s="Displaying existing cases",o={id:"tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",title:"Displaying existing cases",description:"The loadDataverseLayersCustomEndpoint property is used to display records from Dataverse. In this scenario we used it to display existing Case records on the map. See: Advanced Configuration and Capability. A web template containing FetchXML is used to retrieve the records to be shown.",source:"@site/docs/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases.md",sourceDirName:"tutorials/maptaskr-for-power-pages-311-solution",slug:"/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/displaying-existing-cases",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"maptaskrSidebar",previous:{title:"Incident map",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/incident-map"},next:{title:"Reporting a problem",permalink:"/docs/tutorials/maptaskr-for-power-pages-311-solution/reporting-a-problem"}},l={},u=[];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"displaying-existing-cases",children:"Displaying existing cases"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint"})," property is used to display records from Dataverse. In this scenario we used it to display existing Case records on the map. See: ",(0,a.jsx)(t.a,{href:"/docs/power-pages/installation-guide/advanced-configuration-and-capability#custom-endpoints-to-load-related-table-records",children:"Advanced Configuration and Capability"}),". A web template containing FetchXML is used to retrieve the records to be shown."]}),"\n",(0,a.jsxs)(t.p,{children:["Create a new Web Template, in our environment we have called this ",(0,a.jsx)(t.code,{children:"Maptaskr Cases Layer"}),"."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(35152).A+"",width:"936",height:"491"})}),"\n",(0,a.jsx)(t.p,{children:"For the Source enter the following FetchXML (Please note that your field prefixes and attribute names may differ to the below example). This template is also used for the Infobox that appears when you click on a pin."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(41401).A+"",width:"1430",height:"751"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-xml",children:'{% fetchxml pothole_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Pothole" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml traffic_signal_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Traffic Signal" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml streetlight_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Streetlight" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml water_leak_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Water Leak" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml rubbish_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Rubbish" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml park_equipment_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Park Equipment" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml graffiti_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Graffiti" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml nuisance_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Nuisance" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{% fetchxml other_problem_case_query %}\n    <fetch distinct="false" mapping="logical" output-format="xml-platform" version="1.0">\n        <entity name="incident">\n            <attribute name="ticketnumber" />\n            <attribute name="maptaskr_maptaskrlatitude" />\n            <attribute name="maptaskr_maptaskrlongitude" />\n            <link-entity name="subject" from="subjectid" to="subjectid" link-type="outer" alias="Subject">\n                <attribute name="title" alias="subject"/>\n            </link-entity>\n            <attribute name="title" />\n            <attribute name="description" />\n            <filter type="and">\n                <condition attribute="maptaskr_maptaskrlatitude" operator="not-null" />\n                <condition attribute="maptaskr_maptaskrlongitude" operator="not-null" />\n                <condition attribute="statecode" operator="eq" value="0" />\n                <condition entityname="Subject" attribute="title" operator="eq" value="Other problem" />\n            </filter>\n        </entity>\n    </fetch>\n{% endfetchxml %}\n{ "layers": [\n        {\n          "LayerName": "Pothole Cases",\n          "LayerStrokeColor": "#000000",\n          "LayerFillColor": "#000000",\n          "LayerFeatures": [\n            {% for case in pothole_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Traffic Signal Cases",\n          "LayerStrokeColor": "#ff0000",\n          "LayerFillColor": "#ff0000",\n          "LayerFeatures": [\n            {% for case in traffic_signal_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Streetlight Cases",\n          "LayerStrokeColor": "#f7f700",\n          "LayerFillColor": "#f7f700",\n          "LayerFeatures": [\n            {% for case in streetlight_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Water Leak Cases",\n          "LayerStrokeColor": "#13bef2",\n          "LayerFillColor": "#13bef2",\n          "LayerFeatures": [\n            {% for case in water_leak_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Rubbish Cases",\n          "LayerStrokeColor": "#4d1717",\n          "LayerFillColor": "#4d1717",\n          "LayerFeatures": [\n            {% for case in rubbish_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Park Equipment Cases",\n          "LayerStrokeColor": "#00ff00",\n          "LayerFillColor": "#00ff00",\n          "LayerFeatures": [\n            {% for case in park_equipment_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Graffiti Cases",\n          "LayerStrokeColor": "#eb07f7",\n          "LayerFillColor": "#eb07f7",\n          "LayerFeatures": [\n            {% for case in graffiti_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Nuisance",\n          "LayerStrokeColor": "#facc02",\n          "LayerFillColor": "#facc02",\n          "LayerFeatures": [\n            {% for case in nuisance_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        },\n        {\n          "LayerName": "Other Problem Cases",\n          "LayerStrokeColor": "#6423a6",\n          "LayerFillColor": "#6423a6",\n          "LayerFeatures": [\n            {% for case in other_problem_case_query.results.entities %}\n            {\n              "FeatureName": "{{case.ticketnumber}}",\n              "FeatureGeometry": {\n                "type": "Point",\n                "coordinates": [{{case.maptaskr_maptaskrlongitude}},{{case.maptaskr_maptaskrlatitude}}]\n              },\n              "FeatureAttributes": [\n                {"key": "Title", "value":"{{case.title}}"},\n                {"key": "Subject", "value":"{{case.subject}}"},\n                {"key": "Description", "value":"{{case.description}}"}\n              ]\n            }\n            {% unless forloop.last %},{% endunless %}\n            {% endfor %}\n          ]\n        }\n  ]\n}\n\n\n'})}),"\n",(0,a.jsx)(t.p,{children:"We have utilised multiple FetchXML queries to retrieve Cases by their Case Type (Subject) and allocated unique colours for each respective case type which will be reflected by the pins that render on the map. This also matches the colours used for the left-hand quick create button section of the Incident Map page."}),"\n",(0,a.jsxs)(t.p,{children:["Now we need to create a Web Page that uses the ",(0,a.jsx)(t.code,{children:"Maptaskr Cases Layer"})," Web Template. The Partial URL of the Maptaskr Cases Layer Web Page is the value that is used for the ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint"})," property. Please note that you will need to prefix this partial URL with a ",(0,a.jsx)(t.code,{children:"/"})," as per the documentation.\ne.g. ",(0,a.jsx)(t.code,{children:"loadDataverseLayersCustomEndpoint:'/active-incidents'"})]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(58466).A+"",width:"936",height:"491"})}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsx)(t.p,{children:"The Maptaskr PCF control does not display correctly in the Design Studio but can be viewed when the page is previewed. Completed page shown below:"})}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(24473).A+"",width:"1686",height:"908"})}),"\n",(0,a.jsx)(t.p,{children:"Clicking on a pin displays an Infobox containing key information about the case."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(10466).A+"",width:"1756",height:"906"})}),"\n",(0,a.jsx)(t.p,{children:"The colours on the left-hand side section buttons are colour coded against the pin colours defined in the FetchXML covered above. You can also view the legend directly on the map which will display the colour and name of each pin."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:n(30316).A+"",width:"1575",height:"905"})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},30316:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture23.1-4811e925b3eb9dcb39c413ecfa39862d.png"},24473:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture25-333c2eb75dadb79d88b92da214e51469.png"},10466:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture26-c6f180fa7d8367e10da1069436b6b674.png"},35152:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture4-33f06177971455cda73c829a69f43072.png"},41401:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture5-a18be4a5ac81ac41e13f0423d5e6c5c6.png"},58466:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/Picture6-b08e248c8533a15ddb3d3d244658b186.png"},28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var a=n(96540);const i={},r=a.createContext(i);function s(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);